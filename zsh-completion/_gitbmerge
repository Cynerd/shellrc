#compdef gitbmerge
#autoload

_gitbmerge() {
	(( CURRENT > 2)) &&  return # Complete only single dependency
	local GDIR="$(pwd)"
	while [ ! -d "$GDIR/.git"  ]; do
		[ -z "$GDIR" ] && return
		GDIR="${GDIR%/*}"
	done
	GDIR="$GDIR/.git"
	[ -f "$GDIR" ] && GDIR="$(cat "$GDIR")" # This just points to some other directory
	[ -d "$GDIR/refs/heads" ] || return # No completion if there is no local branch
	local branches=()
	for B in "$GDIR"/refs/heads/*; do
		# TODO skip branch on HEAD
		branches+=("${B#$GDIR/refs/heads/}")
	done
	_describe -t branches 'gitbmerge' branches
}

_gitbmerge
# vim: ft=zsh
